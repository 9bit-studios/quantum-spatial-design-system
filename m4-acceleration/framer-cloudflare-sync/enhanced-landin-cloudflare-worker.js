
// Enhanced Cloudflare Worker for Comprehensive Landin Template Rebranding
// Comprehensive Strategic Intelligence Director content transformation

const comprehensiveContent = {
  "hero": {
    "headline": "Transform Your Digital Vision with Quantum-Spatial Innovation",
    "subheadline": "We create immersive experiences that bridge possibility and reality through Apple Intelligence and quantum-spatial design.",
    "cta_primary": "Start Your Quantum Journey",
    "cta_secondary": "Explore Our Portfolio",
    "background_concept": "Quantum-spatial gradient with liquid glass effects"
  },
  "services": {
    "headline": "Our Quantum-Spatial Services",
    "services": [
      {
        "title": "Vision Pro Innovation",
        "description": "Next-generation spatial computing experiences",
        "features": [
          "Immersive interfaces",
          "Spatial design systems",
          "Apple Intelligence integration"
        ]
      },
      {
        "title": "iOS Game Development",
        "description": "Narrative-driven mobile experiences with quantum aesthetics",
        "features": [
          "Interactive storytelling",
          "M4 optimization",
          "CloudKit integration"
        ]
      },
      {
        "title": "AI-Powered Automation",
        "description": "Privacy-first intelligent workflows",
        "features": [
          "Brand-aware content",
          "Workflow automation",
          "Apple Intelligence"
        ]
      }
    ],
    "detailed_services": {
      "headline": "Quantum-Spatial Digital Experiences",
      "intro": "Our innovative approach combines privacy-first principles with cutting-edge technology to create sophisticated digital experiences.",
      "categories": [
        {
          "category": "Game Development",
          "packages": [
            {
              "name": "Starter Package",
              "price": "$15,000",
              "description": "Prototype design and proof of concept",
              "features": [
                "Simple environments",
                "Basic mechanics",
                "One round of revisions"
              ]
            },
            {
              "name": "Core Package",
              "price": "$50,000",
              "description": "Fully functional game with 3-5 levels",
              "features": [
                "Custom UI design",
                "Basic soundscapes",
                "iOS and desktop optimization"
              ]
            },
            {
              "name": "Comprehensive RPG Package",
              "price": "Custom pricing",
              "description": "Expansive world-building and multiplayer integration",
              "features": [
                "Custom assets",
                "Sound design",
                "Animation",
                "Ongoing support"
              ]
            }
          ],
          "starting_price": "$15,000",
          "total_packages": 3,
          "price_range": {
            "min": "$15,000",
            "max": "$50,000"
          }
        },
        {
          "category": "Web Development",
          "packages": [
            {
              "name": "Essential Framer",
              "price": "$5,000",
              "description": "Up to 5 core pages with quantum-spatial design",
              "features": [
                "Custom responsive design",
                "SEO optimization",
                "Analytics integration",
                "30 days support"
              ]
            },
            {
              "name": "Premium AI-Enhanced",
              "price": "$12,000",
              "description": "Intelligent features and automated content systems",
              "features": [
                "AI-powered chat support",
                "Dynamic content generation",
                "Advanced analytics",
                "A/B testing"
              ]
            },
            {
              "name": "Membership Portal",
              "price": "$20,000",
              "description": "Complete subscription-based platform",
              "features": [
                "Member management",
                "Content gating",
                "Community features",
                "Payment processing"
              ]
            }
          ],
          "starting_price": "$5,000",
          "total_packages": 3,
          "price_range": {
            "min": "$5,000",
            "max": "$20,000"
          }
        },
        {
          "category": "AI Innovation",
          "packages": [
            {
              "name": "AI Innovation Suite",
              "price": "$15,000",
              "description": "Custom AI-powered productivity enhancement",
              "features": [
                "Custom iOS apps",
                "AI content generation",
                "Branded assistants",
                "OpenAI/Claude integration"
              ]
            },
            {
              "name": "Enterprise Portals",
              "price": "$20,000",
              "description": "Powerful web applications on Next.js",
              "features": [
                "Custom SaaS development",
                "Client portals",
                "Team collaboration",
                "Analytics dashboard"
              ]
            }
          ],
          "starting_price": "$15,000",
          "total_packages": 2,
          "price_range": {
            "min": "$15,000",
            "max": "$20,000"
          }
        }
      ]
    }
  },
  "about": {
    "headline": "Pioneering Quantum-Spatial Innovation",
    "story": "9Bit Studios emerges from the intersection of possibility and reality, where quantum-spatial innovation meets Apple Intelligence. Founded by creative visionaries who understand that technology should amplify human creativity rather than replace it, we specialize in crafting digital experiences that feel both familiar and revolutionary.Our approach combines the precision of quantum-spatial design with the intuitive nature of Apple's ecosystem, creating solutions that are not just functional, but transformative. Every project we undertake reflects our commitment to privacy-first principles, sophisticated aesthetics, and meaningful innovation.",
    "values": [
      "Privacy-first innovation",
      "Transparent value exchange",
      "Quantum-spatial aesthetics",
      "Apple Intelligence integration",
      "Sophisticated user experiences",
      "Meaningful technological advancement"
    ],
    "founder": {
      "name": "Penny Platt",
      "title": "Creative Director & Strategic Visionary",
      "bio": "Co-founder of 9Bit Studios, pioneering the intersection of Apple Intelligence and quantum-spatial design."
    },
    "value_count": 6
  },
  "portfolio": {
    "headline": "Recent Quantum Creations",
    "projects": [
      {
        "name": "Petersen Games Portal",
        "type": "E-commerce Integration",
        "description": "Shopify-powered platform with quantum aesthetics",
        "slug": "petersen-games-portal",
        "category": "commerce"
      },
      {
        "name": "Oksana Creative Intelligence",
        "type": "AI Platform",
        "description": "Brand-aware content generation with Apple Intelligence",
        "slug": "oksana-creative-intelligence",
        "category": "ai"
      }
    ]
  },
  "contact": {
    "headline": "Begin Your Quantum Journey",
    "intro": "Ready to transform your digital presence with quantum-spatial innovation?",
    "methods": [
      {
        "type": "consultation",
        "label": "Schedule Strategic Consultation",
        "icon": "calendar",
        "description": "Schedule a strategic consultation to discuss your quantum-spatial innovation needs"
      },
      {
        "type": "email",
        "label": "Direct Communication",
        "icon": "mail",
        "description": "Direct communication for immediate inquiries and project discussions"
      },
      {
        "type": "portfolio",
        "label": "Request Portfolio Review",
        "icon": "folder",
        "description": "Request a comprehensive portfolio review and case study presentation"
      }
    ]
  },
  "navigation": {
    "items": [
      "Services",
      "Portfolio",
      "About",
      "Blog",
      "Contact"
    ],
    "structure": [
      {
        "label": "Services",
        "slug": "services",
        "section": "services"
      },
      {
        "label": "Portfolio",
        "slug": "portfolio",
        "section": "portfolio"
      },
      {
        "label": "About",
        "slug": "about",
        "section": "about"
      },
      {
        "label": "Blog",
        "slug": "blog",
        "section": "blog"
      },
      {
        "label": "Contact",
        "slug": "contact",
        "section": "contact"
      }
    ]
  },
  "brand": {
    "name": "9Bit Studios",
    "tagline": "Transform Your Digital Vision with Quantum-Spatial Innovation",
    "footer_tagline": "Transforming possibility into reality through quantum-spatial innovation",
    "design_system": {
      "typography": "SF Pro Display system font stack",
      "effects": "Liquid glass morphism with quantum transitions",
      "color_scheme": {
        "primary": "#6A3093",
        "secondary": "#BF4080",
        "accent": "#5AC8FA",
        "background": "#131A36",
        "text": {
          "primary": "#FFFFFF",
          "secondary": "#CCCCCC",
          "disabled": "#888888"
        },
        "semantic": {
          "success": "#34C759",
          "warning": "#FF9500",
          "error": "#FF3B30",
          "info": "#5AC8FA"
        }
      },
      "spacing": {
        "quantum": "4px",
        "xs": "8px",
        "sm": "16px",
        "md": "24px",
        "lg": "32px",
        "xl": "48px"
      },
      "typography_system": {
        "heading": "'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif",
        "body": "'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif",
        "mono": "'SF Mono', 'JetBrains Mono', monospace"
      }
    }
  },
  "pricing": {
    "game_development": {
      "category": "Game Development",
      "packages": [
        {
          "name": "Starter Package",
          "price": "$15,000",
          "description": "Prototype design and proof of concept",
          "features": [
            "Simple environments",
            "Basic mechanics",
            "One round of revisions"
          ]
        },
        {
          "name": "Core Package",
          "price": "$50,000",
          "description": "Fully functional game with 3-5 levels",
          "features": [
            "Custom UI design",
            "Basic soundscapes",
            "iOS and desktop optimization"
          ]
        },
        {
          "name": "Comprehensive RPG Package",
          "price": "Custom pricing",
          "description": "Expansive world-building and multiplayer integration",
          "features": [
            "Custom assets",
            "Sound design",
            "Animation",
            "Ongoing support"
          ]
        }
      ],
      "starting_price": "$15,000"
    },
    "web_development": {
      "category": "Web Development",
      "packages": [
        {
          "name": "Essential Framer",
          "price": "$5,000",
          "description": "Up to 5 core pages with quantum-spatial design",
          "features": [
            "Custom responsive design",
            "SEO optimization",
            "Analytics integration",
            "30 days support"
          ]
        },
        {
          "name": "Premium AI-Enhanced",
          "price": "$12,000",
          "description": "Intelligent features and automated content systems",
          "features": [
            "AI-powered chat support",
            "Dynamic content generation",
            "Advanced analytics",
            "A/B testing"
          ]
        },
        {
          "name": "Membership Portal",
          "price": "$20,000",
          "description": "Complete subscription-based platform",
          "features": [
            "Member management",
            "Content gating",
            "Community features",
            "Payment processing"
          ]
        }
      ],
      "starting_price": "$5,000"
    },
    "ai_innovation": {
      "category": "AI Innovation",
      "packages": [
        {
          "name": "AI Innovation Suite",
          "price": "$15,000",
          "description": "Custom AI-powered productivity enhancement",
          "features": [
            "Custom iOS apps",
            "AI content generation",
            "Branded assistants",
            "OpenAI/Claude integration"
          ]
        },
        {
          "name": "Enterprise Portals",
          "price": "$20,000",
          "description": "Powerful web applications on Next.js",
          "features": [
            "Custom SaaS development",
            "Client portals",
            "Team collaboration",
            "Analytics dashboard"
          ]
        }
      ],
      "starting_price": "$15,000"
    },
    "total_packages": 8,
    "starting_prices": [
      {
        "category": "Game Development",
        "starting_price": "$15,000"
      },
      {
        "category": "Web Development",
        "starting_price": "$5,000"
      },
      {
        "category": "AI Innovation",
        "starting_price": "$15,000"
      }
    ]
  }
};

addEventListener('fetch', event => {
    event.respondWith(handleComprehensiveRequest(event.request));
});

async function handleComprehensiveRequest(request) {
    const url = new URL(request.url);
    
    if (url.hostname !== 'fantastic-frictionless-063460.framer.app') {
        return fetch(request);
    }
    
    const response = await fetch(request);
    const contentType = response.headers.get('content-type');
    
    if (!contentType || !contentType.includes('text/html')) {
        return response;
    }
    
    let html = await response.text();
    html = applyComprehensiveRebranding(html);
    
    return new Response(html, {
        status: response.status,
        statusText: response.statusText,
        headers: {
            ...response.headers,
            'X-Rebranded-By': '9Bit Studios Quantum-Spatial Innovation'
        }
    });
}

function applyComprehensiveRebranding(html) {
    // Enhanced title and meta tags
    html = html.replace(/<title>.*?<\/title>/gi, 
        `<title>${comprehensiveContent.brand.name} - ${comprehensiveContent.brand.tagline}</title>`);
    
    html = html.replace(/<meta name="description"[^>]*>/gi, 
        `<meta name="description" content="${comprehensiveContent.hero.subheadline}">`);
    
    // Comprehensive hero section rebranding
    html = rebrandHeroSection(html);
    html = rebrandServicesSection(html);
    html = rebrandAboutSection(html);
    html = rebrandPortfolioSection(html);
    html = rebrandContactSection(html);
    html = applyDesignSystemCSS(html);
    
    return html;
}

function rebrandHeroSection(html) {
    // Replace hero headline
    html = html.replace(/(<h1[^>]*>)[^<]*(<\/h1>)/gi, 
        `$1${comprehensiveContent.hero.headline}$2`);
    
    // Replace hero subheadline  
    html = html.replace(/(<p[^>]*class="[^"]*hero[^"]*"[^>]*>)[^<]*(<\/p>)/gi, 
        `$1${comprehensiveContent.hero.subheadline}$2`);
    
    // Replace CTA buttons
    html = html.replace(/(<[^>]*class="[^"]*(?:cta|button)[^"]*primary[^"]*"[^>]*>)[^<]*(<\/[^>]*>)/gi, 
        `$1${comprehensiveContent.hero.cta_primary}$2`);
    
    html = html.replace(/(<[^>]*class="[^"]*(?:cta|button)[^"]*secondary[^"]*"[^>]*>)[^<]*(<\/[^>]*>)/gi, 
        `$1${comprehensiveContent.hero.cta_secondary}$2`);
    
    return html;
}

function rebrandServicesSection(html) {
    // Services headline
    html = html.replace(/(<h[23][^>]*class="[^"]*service[^"]*"[^>]*>)[^<]*(<\/h[23]>)/gi, 
        `$1${comprehensiveContent.services.headline}$2`);
    
    // Individual service replacements
    comprehensiveContent.services.services.forEach((service, index) => {
        const servicePattern = new RegExp(`(<div[^>]*class="[^"]*service-item[^"]*"[^>]*>.*?)(<h[34][^>]*>)[^<]*(<\/h[34]>)(.*?)(<p[^>]*>)[^<]*(<\/p>)`, 'gis');
        html = html.replace(servicePattern, `$1$2${service.title}$3$4$5${service.description}$6`);
    });
    
    return html;
}

function rebrandAboutSection(html) {
    // About headline
    html = html.replace(/(<h[23][^>]*class="[^"]*about[^"]*"[^>]*>)[^<]*(<\/h[23]>)/gi, 
        `$1${comprehensiveContent.about.headline}$2`);
    
    // About story
    html = html.replace(/(<div[^>]*class="[^"]*about[^"]*story[^"]*"[^>]*>.*?)(<p[^>]*>)[^<]*(<\/p>)/gis, 
        `$1$2${comprehensiveContent.about.story.split('')[0]}$3`);
    
    // Founder information
    html = html.replace(/(<[^>]*class="[^"]*founder[^"]*name[^"]*"[^>]*>)[^<]*(<\/[^>]*>)/gi, 
        `$1${comprehensiveContent.about.founder.name}$2`);
    
    html = html.replace(/(<[^>]*class="[^"]*founder[^"]*title[^"]*"[^>]*>)[^<]*(<\/[^>]*>)/gi, 
        `$1${comprehensiveContent.about.founder.title}$2`);
    
    return html;
}

function rebrandPortfolioSection(html) {
    html = html.replace(/(<h[23][^>]*class="[^"]*portfolio[^"]*"[^>]*>)[^<]*(<\/h[23]>)/gi, 
        `$1${comprehensiveContent.portfolio.headline}$2`);
    
    comprehensiveContent.portfolio.projects.forEach((project, index) => {
        const projectPattern = new RegExp(`(<div[^>]*class="[^"]*project[^"]*"[^>]*>.*?)(<h[34][^>]*>)[^<]*(<\/h[34]>)(.*?)(<p[^>]*>)[^<]*(<\/p>)`, 'gis');
        html = html.replace(projectPattern, `$1$2${project.name}$3$4$5${project.description}$6`);
    });
    
    return html;
}

function rebrandContactSection(html) {
    html = html.replace(/(<h[23][^>]*class="[^"]*contact[^"]*"[^>]*>)[^<]*(<\/h[23]>)/gi, 
        `$1${comprehensiveContent.contact.headline}$2`);
    
    html = html.replace(/(<p[^>]*class="[^"]*contact[^"]*intro[^"]*"[^>]*>)[^<]*(<\/p>)/gi, 
        `$1${comprehensiveContent.contact.intro}$2`);
    
    return html;
}

function applyDesignSystemCSS(html) {
    const ds = comprehensiveContent.brand.design_system;
    
    const enhancedCSS = `
    <style>
    :root {
        --quantum-primary: ${ds.color_scheme.primary};
        --quantum-secondary: ${ds.color_scheme.secondary};
        --quantum-accent: ${ds.color_scheme.accent};
        --quantum-bg: ${ds.color_scheme.background};
        --quantum-text: ${ds.color_scheme.text.primary};
        --quantum-text-secondary: ${ds.color_scheme.text.secondary};
        
        --quantum-spacing-xs: ${ds.spacing.xs};
        --quantum-spacing-sm: ${ds.spacing.sm};
        --quantum-spacing-md: ${ds.spacing.md};
        --quantum-spacing-lg: ${ds.spacing.lg};
        --quantum-spacing-xl: ${ds.spacing.xl};
    }
    
    body {
        font-family: ${ds.typography_system.body} !important;
        background: linear-gradient(135deg, var(--quantum-primary), var(--quantum-secondary)) !important;
        color: var(--quantum-text) !important;
    }
    
    h1, h2, h3, h4, h5, h6 {
        font-family: ${ds.typography_system.heading} !important;
        background: linear-gradient(45deg, var(--quantum-accent), var(--quantum-primary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .quantum-glass {
        backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(90, 200, 250, 0.3);
        border-radius: 12px;
    }
    
    .quantum-card {
        background: linear-gradient(135deg, rgba(106, 48, 147, 0.2), rgba(191, 64, 128, 0.1));
        backdrop-filter: blur(20px);
        border: 1px solid rgba(90, 200, 250, 0.3);
        border-radius: 12px;
        padding: var(--quantum-spacing-md);
        transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    .quantum-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 32px rgba(106, 48, 147, 0.3);
    }
    
    .quantum-button {
        background: linear-gradient(135deg, var(--quantum-primary), var(--quantum-secondary));
        border: none;
        border-radius: 8px;
        padding: var(--quantum-spacing-sm) var(--quantum-spacing-md);
        color: var(--quantum-text);
        font-family: ${ds.typography_system.heading};
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        cursor: pointer;
    }
    
    .quantum-button:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 16px rgba(191, 64, 128, 0.4);
    }
    
    /* Apply quantum classes to existing elements */
    .card, [class*="card"] { @extend .quantum-card; }
    .button, [class*="button"], .cta, [class*="cta"] { @extend .quantum-button; }
    </style>
    `;
    
    html = html.replace('</head>', enhancedCSS + '</head>');
    
    return html;
}
