<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum-Spatial Design System - Cloudflare Integration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body, html {
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        #root {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            padding: 20px;
            background: #131A36;
            color: white;
        }
        
        .content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .card {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .status {
            padding: 12px;
            background: #f0f0f0;
            border-radius: 8px;
            margin-top: 12px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        button {
            padding: 8px 16px;
            background: #5AC8FA;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }
        
        button:hover {
            background: #4aa8d5;
        }
        
        .state-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 12px 0;
        }
        
        .state-button {
            padding: 8px 16px;
            border: 1px solid #5AC8FA;
            background: transparent;
            color: #5AC8FA;
            border-radius: 6px;
            cursor: pointer;
            text-transform: capitalize;
        }
        
        .state-button.active {
            background: #5AC8FA;
            color: white;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="header">
            <h1>Quantum-Spatial Design System</h1>
            <p>Cloudflare Integration Test</p>
        </div>
        
        <div class="content">
            <div class="card">
                <h2>Cloudflare Worker Status</h2>
                <p>Testing connection to the Cloudflare Worker at <code>https://design-system-staging.9bitstudios.io</code></p>
                <button id="test-connection">Test Connection</button>
                <div id="connection-status" class="status">Ready to test</div>
            </div>
            
            <div class="card">
                <h2>Design Tokens</h2>
                <p>Fetch design tokens for different states from the Cloudflare Worker</p>
                <div class="state-selector">
                    <button class="state-button" data-state="heritage">Heritage</button>
                    <button class="state-button" data-state="transitional">Transitional</button>
                    <button class="state-button active" data-state="quantum">Quantum</button>
                    <button class="state-button" data-state="superposition">Superposition</button>
                </div>
                <div id="tokens-status" class="status">Select a state to fetch tokens</div>
            </div>
            
            <div class="card">
                <h2>Device Detection</h2>
                <p>Detect device capabilities for M4 optimization</p>
                <button id="detect-device">Detect Device</button>
                <div id="device-status" class="status">Ready to detect</div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CLOUDFLARE_URL = 'https://design-system-staging.9bitstudios.io';
        let currentState = 'quantum';
        
        // DOM elements
        const testConnectionBtn = document.getElementById('test-connection');
        const connectionStatus = document.getElementById('connection-status');
        const stateButtons = document.querySelectorAll('.state-button');
        const tokensStatus = document.getElementById('tokens-status');
        const detectDeviceBtn = document.getElementById('detect-device');
        const deviceStatus = document.getElementById('device-status');
        
        // Test connection to Cloudflare Worker
        testConnectionBtn.addEventListener('click', async () => {
            connectionStatus.textContent = 'Testing connection...';
            try {
                const response = await fetch(`${CLOUDFLARE_URL}/health`);
                const data = await response.json();
                connectionStatus.textContent = `Connection successful!Status: ${data.status}Version: ${data.version}Environment: ${data.environment}`;
                connectionStatus.style.background = '#e6ffec';
            } catch (error) {
                connectionStatus.textContent = `Connection failed: ${error.message}`;
                connectionStatus.style.background = '#ffe6e6';
            }
        });
        
        // Fetch design tokens
        stateButtons.forEach(button => {
            button.addEventListener('click', async () => {
                const state = button.dataset.state;
                currentState = state;
                
                // Update button styles
                stateButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                // Fetch tokens
                tokensStatus.textContent = `Fetching ${state} tokens...`;
                try {
                    const response = await fetch(`${CLOUDFLARE_URL}/design-system/tokens?state=${state}`);
                    const tokens = await response.json();
                    
                    // Display token info
                    tokensStatus.textContent = `✅ Tokens fetched successfully!Name: ${tokens._meta.name}Description: ${tokens._meta.description}Version: ${tokens._meta.version}Primary Color: ${tokens.colors.primary}Secondary Color: ${tokens.colors.secondary}Accent Color: ${tokens.colors.accent}Sample properties: ${Object.keys(tokens).join(', ')}`;
                    tokensStatus.style.background = '#e6ffec';
                    
                    // Apply some token styles to the page
                    document.body.style.setProperty('--color-primary', tokens.colors.primary);
                    document.body.style.setProperty('--color-secondary', tokens.colors.secondary);
                    document.body.style.setProperty('--color-accent', tokens.colors.accent);
                    
                    if (tokens.colors.background) {
                        if (typeof tokens.colors.background === 'object') {
                            document.body.style.setProperty('--color-background', tokens.colors.background.dark);
                        } else {
                            document.body.style.setProperty('--color-background', tokens.colors.background);
                        }
                    }
                    
                    // Update the header color
                    document.querySelector('.header').style.background = tokens.colors.primary;
                    
                    // Update buttons
                    const buttons = document.querySelectorAll('button:not(.state-button)');
                    buttons.forEach(btn => {
                        btn.style.background = tokens.colors.accent;
                    });
                    
                    // Update active state button
                    document.querySelectorAll('.state-button.active').forEach(btn => {
                        btn.style.background = tokens.colors.accent;
                        btn.style.borderColor = tokens.colors.accent;
                    });
                    
                    // Update state buttons border
                    document.querySelectorAll('.state-button:not(.active)').forEach(btn => {
                        btn.style.borderColor = tokens.colors.accent;
                        btn.style.color = tokens.colors.accent;
                    });
                    
                } catch (error) {
                    tokensStatus.textContent = `Error fetching ${state} tokens: ${error.message}`;
                    tokensStatus.style.background = '#ffe6e6';
                }
            });
        });
        
        // Detect device capabilities
        detectDeviceBtn.addEventListener('click', async () => {
            deviceStatus.textContent = 'Detecting device capabilities...';
            
            try {
                // First try the M4 optimization endpoint
                try {
                    const response = await fetch(`${CLOUDFLARE_URL}/m4-optimization`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        deviceStatus.textContent = `✅ Device detected through M4 optimization endpoint!M4 Compatible: ${data.isM4Compatible ? 'Yes' : 'No'}Apple Silicon: ${data.isAppleSilicon ? 'Yes' : 'No'}Rendering API: ${data.renderingAPI}Recommended State: ${data.isM4Compatible ? 'superposition' : data.isAppleSilicon ? 'quantum' : 'transitional'}`;
                        deviceStatus.style.background = '#e6ffec';
                        return;
                    }
                } catch (error) {
                    console.warn('M4 optimization endpoint not available, falling back to navigator detection');
                }
                
                // Fall back to navigator detection
                const userAgent = navigator.userAgent;
                const isAppleSilicon = userAgent.includes('Mac') && !userAgent.includes('Intel');
                const isM4 = isAppleSilicon && navigator.hardwareConcurrency >= 8;
                
                deviceStatus.textContent = `✅ Device detected through navigator!User Agent: ${userAgent}Hardware Concurrency: ${navigator.hardwareConcurrency}M4 Compatible: ${isM4 ? 'Yes' : 'No'}Apple Silicon: ${isAppleSilicon ? 'Yes' : 'No'}Recommended State: ${isM4 ? 'superposition' : isAppleSilicon ? 'quantum' : 'transitional'}`;
                deviceStatus.style.background = '#e6ffec';
                
            } catch (error) {
                deviceStatus.textContent = `Error detecting device: ${error.message}`;
                deviceStatus.style.background = '#ffe6e6';
            }
        });
        
        // Auto-load quantum tokens on page load
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector('.state-button[data-state="quantum"]').click();
            testConnectionBtn.click();
        });
    </script>
</body>
</html>